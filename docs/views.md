# Представления (Views)

В этом разделе описаны все представления Django, используемые в проекте Lingvista.

## Основные представления

### `main_page`
- **URL**: `/`
- **Метод**: GET
- **Описание**: Отображает главную страницу приложения.
- **Шаблон**: `html/pages/main_page.html`

### `policy_view`
- **URL**: `/policy/`
- **Метод**: GET
- **Описание**: Отображает страницу с политикой конфиденциальности.
- **Шаблон**: `html/pages/policy_page.html`

---

## Аутентификация

### `login_view`
- **URL**: `/login/`
- **Метод**: GET, POST
- **Описание**: Обрабатывает вход пользователя в систему.
- **Форма**: `UserLogInForm`
- **Логика**:
  - При успешной аутентификации перенаправляет на главную страницу.
  - При ошибке выводит сообщение "Invalid username or password".
- **Шаблон**: `html/pages/login_page.html`

### `register_view`
- **URL**: `/register/`
- **Метод**: GET, POST
- **Описание**: Обрабатывает регистрацию нового пользователя.
- **Форма**: `UserRegistrationForm`
- **Логика**:
  - При успешной регистрации создает профиль пользователя и автоматически входит в систему.
  - Выводит сообщение "Registration is successful!".
- **Шаблон**: `html/pages/registry_page.html`

---

## Работа с уроками и заданиями

### `tasks_view`
- **URL**: `/level/<str:level>/lesson/<int:lesson>/`
- **Метод**: GET, POST
- **Декоратор**: `@login_required`
- **Описание**: Отображает задания для конкретного урока и обрабатывает ответы пользователя.
- **Логика**:
  - Проверяет, не пройден ли урок на 100%.
  - При POST-запросе проверяет ответы пользователя и сохраняет прогресс.
  - При успешном прохождении (≥70%) открывает следующий уровень.
  - Использует модель `UserTasksProgress` для сохранения результатов.
- **Шаблон**: `html/pages/tasks_page.html`

### `lessons_view`
- **URL**: `/level/<str:level>/`
- **Метод**: GET
- **Декоратор**: `@login_required`
- **Описание**: Отображает список уроков для выбранного уровня языка.
- **Логика**:
  - Показывает прогресс пользователя по каждому уроку.
  - Использует модель `UserTasksProgress` для определения завершенных уроков.
- **Шаблон**: `html/pages/lessons_page.html`

### `langlevel_view`
- **URL**: `/levels/`
- **Метод**: GET
- **Декоратор**: `@login_required`
- **Описание**: Отображает список всех уровней языка с указанием доступности.
- **Логика**:
  - Показывает, какие уровни разблокированы для пользователя.
  - Определяет завершенные уровни с помощью функции `check_level_completion`.
- **Шаблон**: `html/pages/langlevel_page.html`

### `check_level_completion` (вспомогательная функция)
- **Описание**: Проверяет, полностью ли пользователь прошел уровень.
- **Параметры**:
  - `user`: объект пользователя
  - `level`: уровень языка (например, 'A1')
- **Возвращает**: `True`, если все уроки уровня пройдены на 100%, иначе `False`.

---

## Профиль пользователя

### `profile_view`
- **URL**: `/profile/`
- **Метод**: GET
- **Декоратор**: `@login_required`
- **Описание**: Отображает профиль пользователя с прогрессом обучения.
- **Логика**:
  - Показывает разблокированные уровни через `profile.get_unlocked_levels()`.
  - Отображает прогресс по заданиям (`UserTasksProgress`).
- **Шаблон**: `html/pages/account_page.html`

### `edit_profile`
- **URL**: `/profile/edit/`
- **Метод**: GET, POST
- **Декоратор**: `@login_required`
- **Описание**: Позволяет редактировать профиль, email и пароль.
- **Формы**:
  - `ProfileEditForm`: для изменения аватара и данных профиля.
  - `EmailChangeForm`: для изменения email.
  - `CustomPasswordChangeForm`: для изменения пароля.
- **Логика**:
  - Обрабатывает изменения данных в зависимости от отправленной формы.
  - Выводит соответствующие сообщения об успешном обновлении.
- **Шаблон**: `html/pages/accountedit_page.html`

---

## Дополнительная информация

Все представления, требующие аутентификации, защищены декоратором `@login_required`. При попытке доступа неавторизованным пользователем будет выполнено перенаправление на страницу входа.

Для работы с уроками и заданиями используются модели:
- `LanguageLevel`
- `Lesson`
- `Task`
- `UserTasksProgress`
